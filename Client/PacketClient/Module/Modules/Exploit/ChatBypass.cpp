#include "ChatBypass.h"
#include "../pch.h"
#include <locale>
#include <codecvt>

ChatBypass::ChatBypass() : IModule(0, Category::EXPLOIT, "Bypass anti spammer") {
}

const char* ChatBypass::getModuleName() {
	return "ChatBypass";
}

void ChatBypass::onSendPacket(C_Packet* packet) {
	if (packet->isInstanceOf<C_TextPacket>()) {
		C_TextPacket* funy = reinterpret_cast<C_TextPacket*>(packet);
		std::wstring_convert<std::codecvt_utf8<char32_t>, char32_t> converter;
		std::string bypassStr = converter.to_bytes(static_cast<char32_t>(random(262144, 917503)));
		std::string bypassStr2 = converter.to_bytes(static_cast<char32_t>(random(262144, 917503)));
		std::string text = bypassStr + funy->message.getText() + bypassStr2;
		funy->message.resetWithoutDelete();
		funy->message = text;
	}
}

